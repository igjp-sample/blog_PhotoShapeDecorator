<Window x:Class="PhotoShapeDecorator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PhotoShapeDecorator"
        xmlns:ig="http://schemas.infragistics.com/xaml"
        mc:Ignorable="d"
        Title="MainWindow" Height="450" Width="800"
        WindowStartupLocation="CenterScreen">
    <Grid x:Name="RootGrid">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="150"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="200"/>
        </Grid.ColumnDefinitions>

        <!-- シェイプエリア -->
        <Border Grid.Column="0" Background="LightGray" Padding="10">
            <StackPanel>
                <TextBlock Text="シェイプ" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>

                <Ellipse x:Name="CircleShape" 
                         Width="50" Height="50" 
                         Fill="Red" 
                         Stroke="DarkRed" 
                         StrokeThickness="3"
                         Cursor="Hand">
                    <ig:DragDropManager.DragSource>
                        <ig:DragSource IsDraggable="True" 
                                     DragChannels="ShapeChannel"
                                     Drop="DragSource_Drop"/>
                    </ig:DragDropManager.DragSource>
                </Ellipse>
            </StackPanel>
        </Border>

        <!-- 写真エリア（中央） -->
        <Border Grid.Column="1"
        BorderBrush="DarkGray"
        BorderThickness="2"
        Background="White"
        Margin="10">
            <!-- HorizontalAlignment/VerticalAlignmentをStretchに設定 -->
            <Canvas x:Name="PhotoCanvas" 
        Background="Transparent"
        ClipToBounds="True">
                <Image x:Name="BackgroundImage"
           Width="{Binding ActualWidth, ElementName=PhotoCanvas}"
           Height="{Binding ActualHeight, ElementName=PhotoCanvas}"
           Stretch="Uniform"
           IsHitTestVisible="False"/>
                <ig:DragDropManager.DropTarget>
                    <ig:DropTarget IsDropTarget="True" DropChannels="ShapeChannel"/>
                </ig:DragDropManager.DropTarget>
            </Canvas>
        </Border>

        <!-- コントロールエリア -->
        <Border Grid.Column="2" Background="LightYellow" Padding="10">
            <StackPanel>
                <TextBlock Text="コントロール" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>

                <Button x:Name="SelectBackgroundButton" 
                        Content="背景を選ぶ" 
                        Click="SelectBackgroundButton_Click"
                        Height="40" Margin="0,0,0,10"/>

                <Button x:Name="SaveImageButton" 
                        Content="画像保存" 
                        Click="SaveImageButton_Click"
                        Height="40" Margin="0,0,0,20"/>

                <!-- ゴミ箱エリア -->
                <Border x:Name="TrashArea" 
                        Background="LightCoral" 
                        Height="150" 
                        Margin="0,0,0,20">
                    <StackPanel Orientation="Vertical" 
                                VerticalAlignment="Center" 
                                HorizontalAlignment="Center">
                        <TextBlock Text="🗑️" FontSize="40" HorizontalAlignment="Center"/>
                        <TextBlock Text="ゴミ箱"
                                   HorizontalAlignment="Center"
                                   FontWeight="Bold" FontSize="16" Margin="0,5,0,0"/>
                        <TextBlock Text="（ドロップして削除）"
                                   HorizontalAlignment="Center"
                                   FontSize="12" Margin="0,5,0,0"/>
                    </StackPanel>
                    <ig:DragDropManager.DropTarget>
                        <ig:DropTarget IsDropTarget="True" 
                                     DropChannels="ShapeChannel"/>
                    </ig:DragDropManager.DropTarget>
                </Border>
            </StackPanel>
        </Border>

        <!-- ゴースト表示用オーバーレイCanvas -->
        <Canvas x:Name="GhostOverlay" 
                Grid.ColumnSpan="3"
                IsHitTestVisible="False" 
                Background="Transparent"
                Panel.ZIndex="10000"/>
    </Grid>
</Window>
